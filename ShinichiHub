local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")

-- 🌟 Config
_G.AutoCollectChest = _G.AutoCollectChest or true  
_G.EspChest = _G.EspChest or true
_G.StopGodChalice = _G.StopGodChalice or true
_G.StopFistOfDarkness = _G.StopFistOfDarkness or true
_G.SelectTeam = _G.SelectTeam or "Pirate" -- "Marines" or "Pirate"
_G.AutoHopServer = _G.AutoHopServer or true -- Chỉ hop nếu không còn chest

-- 🌟 Auto chọn Team
if _G.SelectTeam then
    local Team = _G.SelectTeam == "Pirate" and "Pirates" or "Marines"
    ReplicatedStorage.Remotes.CommF_:InvokeServer("SetTeam", Team)
    wait(1)
end

-- 🌟 ESP Chest
if _G.EspChest then
    spawn(function()
        while wait(1) do
            for _, chest in pairs(Workspace:GetChildren()) do
                if chest:IsA("Model") and string.find(chest.Name, "Chest") then
                    if not chest:FindFirstChild("NameEsp") then
                        local Esp = Instance.new("BillboardGui", chest)
                        Esp.Name = "NameEsp"
                        Esp.Size = UDim2.new(1, 200, 1, 30)
                        Esp.Adornee = chest
                        Esp.AlwaysOnTop = true
                        local Label = Instance.new("TextLabel", Esp)
                        Label.Text = chest.Name
                        Label.TextColor3 = Color3.new(1, 1, 1)
                        Label.BackgroundTransparency = 1
                        Label.Size = UDim2.new(1, 0, 1, 0)
                    end
                end
            end
        end
    end)
end

-- 🌟 Auto Collect Chest
if _G.AutoCollectChest then
    spawn(function()
        while wait() do
            local Chests = {}
            for _, v in pairs(Workspace:GetChildren()) do
                if v:IsA("Model") and string.find(v.Name, "Chest") then
                    table.insert(Chests, v)
                end
            end

            if #Chests > 0 then
                local ClosestChest = nil
                local ClosestDist = math.huge
                for _, chest in pairs(Chests) do
                    local Dist = (LocalPlayer.Character.HumanoidRootPart.Position - chest:GetPivot().Position).Magnitude
                    if Dist < ClosestDist then
                        ClosestDist = Dist
                        ClosestChest = chest
                    end
                end

                if ClosestChest then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = ClosestChest:GetPivot()
                    wait(1)
                end
            else
                -- 🌟 Kiểm tra có Fist of Darkness hoặc God Chalice không
                for _, item in pairs(LocalPlayer.Backpack:GetChildren()) do
                    if (_G.StopGodChalice and item.Name == "God's Chalice") or 
                       (_G.StopFistOfDarkness and item.Name == "Fist of Darkness") then
                        return
                    end
                end

                -- 🌟 Nếu không còn chest và AutoHop bật -> Hop Server
                if _G.AutoHopServer then
                    TeleportService:Teleport(game.PlaceId, LocalPlayer)
                end
            end
        end
    end)
end

-- 🌟 UI Menu
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local ChestCount = Instance.new("TextLabel")
local Status = Instance.new("TextLabel")
local NextChestDist = Instance.new("TextLabel")
local ToggleUI = Instance.new("TextButton")
local CloseUI = Instance.new("TextButton")

ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

MainFrame.Size = UDim2.new(0, 300, 0, 200)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.Parent = ScreenGui

Title.Text = "Shinichi Hub"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Parent = MainFrame

ChestCount.Text = "Chest Collect: 0"
ChestCount.Position = UDim2.new(0, 10, 0, 40)
ChestCount.Size = UDim2.new(1, -20, 0, 20)
ChestCount.TextColor3 = Color3.new(1, 1, 1)
ChestCount.BackgroundTransparency = 1
ChestCount.Parent = MainFrame

Status.Text = "Status: Farming"
Status.Position = UDim2.new(0, 10, 0, 70)
Status.Size = UDim2.new(1, -20, 0, 20)
Status.TextColor3 = Color3.new(1, 1, 1)
Status.BackgroundTransparency = 1
Status.Parent = MainFrame

NextChestDist.Text = "Next Chest Distance: 0"
NextChestDist.Position = UDim2.new(0, 10, 0, 100)
NextChestDist.Size = UDim2.new(1, -20, 0, 20)
NextChestDist.TextColor3 = Color3.new(1, 1, 1)
NextChestDist.BackgroundTransparency = 1
NextChestDist.Parent = MainFrame

ToggleUI.Text = "-"
ToggleUI.Position = UDim2.new(1, -30, 0, 5)
ToggleUI.Size = UDim2.new(0, 20, 0, 20)
ToggleUI.TextColor3 = Color3.new(1, 1, 1)
ToggleUI.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ToggleUI.Parent = MainFrame

CloseUI.Text = "X"
CloseUI.Position = UDim2.new(1, -60, 0, 5)
CloseUI.Size = UDim2.new(0, 20, 0, 20)
CloseUI.TextColor3 = Color3.new(1, 1, 1)
CloseUI.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
CloseUI.Parent = MainFrame

ToggleUI.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

CloseUI.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)
